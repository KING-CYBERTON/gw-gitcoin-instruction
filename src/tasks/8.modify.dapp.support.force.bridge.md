# 8. Modify the Ported dApp so it Supports Ethereum Assets via Force Bridge

To take your Ethereum application on Nervos to the next-level and make it cross-chain you should consider adding support for one-step transfers of assets from various blockchains. This is exactly what Force Bridge provides.

## Requirements

Before starting, you will need to setup your development environment. For information about setup and requirements please [review this article](../tasks-setup-and-requirements/tasks-setup-and-requirements.md).


## Task Instructions

> Note: Before starting the tasks, it is recommended that you review the [Task Submission](#task-submission) section so you know what materials you will need to provide to judges to review your task submission.

To modify your EVM (Ethereum Virtual Machine) application on Nervos to support assets living on the Ethereum chain (such as ETH, USDT, USDC, DAI) you need to integrate `nervos-godwoken-integration` library into your application to calculate the receiving addresses for the transfers through the bridge from the Ethereum. After the transfer through the bridge is completed your users will be able to use the transferred token on Layer 2 in your application's smart contracts.

### 1.Install dependencies

```
yarn add nervos-godwoken-integration@0.0.2
```

### 2. Generate Layer 2 Deposit Address

Layer 2 Deposit address is an address on Nervos Layer 1 that acts as a gateway into Layer 2 for your specific Ethereum address. All CKB (native Nervos currency) and SUDT tokens transferred to this address will be automatically collected by a block producer and you'll be able to use them in Layer 2.

Address mentioned above is required for initiating a transfer through the bridge. This is how you can calculate it for your user:

```js
const { AddressTranslator } = require('nervos-godwoken-integration');

// ...

const addressTranslator = new AddressTranslator();

const depositAddress = await addressTranslator.getLayer2DepositAddress(web3, ETHEREUM_ADDRESS);

console.log(`Deposit to Layer 2 address on Layer 1: \n${depositAddress.addressString}`);
```

### 3. Redirect user to Force Bridge website

After you've integrated calculating user's deposit address you can redirect him to Force Bridge website:
- https://force-bridge-dev.ckbapp.dev/bridge/Ethereum/Nervos

You can also use the other link which already has selected asset preconfigured (ETH):
- https://force-bridge-dev.ckbapp.dev/bridge/Ethereum/Nervos?xchain-asset=0x0000000000000000000000000000000000000000

Tell the user to complete the transfer through the bridge where **"Receiver" is the address obtained in the step 2**. For complete instructions how to do a transfer through the Force Bridge you can redirect user to the following tutorial:

- https://github.com/Kuzirashi/gw-gitcoin-instruction/blob/master/src/tasks/6.use.force.bridge.to.deposit.md#3-initiate-a-force-bridge-transfer

You can also copy the above instruction and present it on your website if you want.

### 4. Calculate user's Polyjuice address.

Okay, back to your application. 

As soon as the user completes the transfer through the bridge your application should know about it. The easiest way to do it is to have a component on your website that displays user's balance of the bridged asset.

First you need to calculate user's Polyjuice address that corresponds to his individual Ethereum address though. **Polyjuice address is what SUDT-ERC20 proxy token smart contract will recognize for checking the balance of the bridged assets.**

This the code for calculating Polyjuice address from the Ethereum address:

```js
const { AddressTranslator } = require('nervos-godwoken-integration');

// ...

const addressTranslator = new AddressTranslator();
const polyjuiceAddress = addressTranslator.ethAddressToGodwokenShortAddress(ETHEREUM_ADDRESS);
console.log(`Corresponding Polyjuice address: ${polyjuiceAddress}\n`);
```

### 5. Display user's Layer 2 balance on your website

A requirement for being able to display Layer 2 balance of a bridged asset is to deploy a special smart contract which acts as a proxy.

In this step deploy SUDT-ERC20 Proxy smart contract for the transferred asset. You need to do it only once per asset. Later all users can use it (call `balanceOf` function). If you are bridging Ethereum on testnet it has a constant SUDT ID equal to **142**. You need to pass this parameter in a constructor. Regarding other constructor arguments you can be creative and choose anything that works for you.

[This is a tutorial how to deploy SUDT-ERC20 proxy smart contract.](./5.deploy.erc20.proxy.contract.md) 

> Note: Remember to use SUDT ID 142 if you integrated ETH currency support on testnet! :) Other assets such as USDT have different SUDT IDs.

### 6. Add check balance smart contract call to your application.

Use user's Polyjuice address from the 4th step to check the balance and display it to the user on your website.

At this point if the user has already completed his bridge transfer he can check the balance. If the balance is higher than zero it means you can just use this token as you would use any ERC20 token in your application.

[You can find tutorial and code how to check the bridged token balance here.](./5.deploy.erc20.proxy.contract.md#3-check-your-layer-2-sudt-balance)

> Note: If you would like to have more control over the bridge transfer and build your own frontend you can take advantage of [`BridgeRPCHandler`](https://github.com/Roger-RumbleFish/nervos-godwoken-integration/blob/master/src/bridge/force-bridge-handler.ts) exposed by `nervos-godwoken-integration`. This can eliminate a need for redirecting user outside of your application. It is considered advanced approach however.

## Task Submission

To complete the task, you will need to submit the following materials for review by the judges:

1. Link to the GitHub repository with your application that integrates Force Bridge support.
2. A screenshot or video of your ported application.
3. A SUDT-ERC20 Proxy smart contract address that you've deployed.