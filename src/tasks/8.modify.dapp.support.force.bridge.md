# 8. Modify the Ported dApp so it Supports Ethereum Assets via Force Bridge

One of the biggest challenges to mass adoption is making applications that are both secure and easy for the end user. The landscape of tooling and infrastructure is a challenge for developers who must fight with the delicate balance that they deliver to their users. The tools are often complicated and difficult to use. The infrastructure lacks standardization and seamless compatibility. While progress continues to be made, the end is still not yet in sight.

Competition is fierce in the blockchain world, and protocols are being reinvented as fast as they are being adopted. There are big challenges in blockchain that have yet to be solved, and multiple industry leaders are taking very different approaches to their solutions. The standards that have emerged are still evolved, and the ability to integrate between these different pieces of infrastructure is still a challenge that has yet to be addressed.

The flexibility of Nervos' underlying platform is a big step towards the future of deeply integrated experiences that are simplified and accessible to the average every day user. Developers can adapt and extend the platform to whatever solutions are in use today, rather than having to wait for the solution to be developed. Developers are able to mix and match layers of infrastructure like lego bricks, then unify a stream of motions into a single simplified action for the user. We'll demonstrate one such example in this task.

## Task Instructions

> Note: Before starting the tasks, it is recommended that you review the [Task Submission](#task-submission) section so you know what materials you will need to provide to judges to review your task submission.

Modify your existing EVM dApp from the [previous task](./7.port.eth.dapp.md) to support one-step asset transfers using Force Bridge. This is done by integrating the `nervos-godwoken-integration` library into your application.

Your dApp will calculate special receiving addresses for transfers from Ethereum through Force Bridge. These addresses will allow users to transfer the assets through Force Bridge directly to Layer 2 so they are ready for your application to interact with.

In this task we will describe the changes that need to be made, but there is no example project. You will need to make these changes to your own application in order to get credit for completing the task.

### 1.Install Godwoken Integration Package

The first step is to install the `nervos-godwoken-integration` package. This package contains the tools needed to integrate Nervos' Layer 2 infrastructure into your application.

```sh
yarn add nervos-godwoken-integration@0.0.2
```

### 2. Generate a Layer 2 Deposit Address on Layer 1

A layer 2 Deposit address is an address on Nervos' Layer 1 that acts as a gateway into Layer 2. All CKBytes and SUDT tokens transferred to this address on Layer 1 will be automatically collected by the block producing nodes and delivered to Layer 2.

The code snippet below can be used to generate a Layer 2 deposit address after replacing `<ETHEREUM_ADDRESS>` with the user's Ethereum address on Layer 2.

```js
const { AddressTranslator } = require('nervos-godwoken-integration');

const addressTranslator = new AddressTranslator();
const depositAddress = await addressTranslator.getLayer2DepositAddress(web3, <ETHEREUM_ADDRESS>);

console.log(`Deposit to Layer 2 address on Layer 1: \n${depositAddress.addressString}`);
```

### 3. Redirect the User to the Force Bridge Website

After your application has calculated and displayed the user's deposit address, you can instruct them to use the Force Bridge website:

- https://force-bridge-dev.ckbapp.dev/bridge/Ethereum/Nervos

Optionally, you can specify the asset to be transferred so it is already populated. Below is the link for pre-selecting ETH:

- https://force-bridge-dev.ckbapp.dev/bridge/Ethereum/Nervos?xchain-asset=0x0000000000000000000000000000000000000000

The user should be instructed to input their Layer 2 Deposit Address as the `Receiver` address from the previous step.

A complete guide on how to do a transfer through the Force Bridge is available through [this tutorial](https://github.com/Kuzirashi/gw-gitcoin-instruction/blob/master/src/tasks/6.use.force.bridge.to.deposit.md#3-initiate-a-force-bridge-transfer). Feel free to copy any portion of this tutortial into the documentation for your dApp.

### 4. Calculate the User's Polyjuice Address

Okay, back to your application.

As soon as the user completes the transfer through the bridge your application should know about it. The easiest way to do it is to have a component on your website that displays user's balance of the bridged asset.

First you need to calculate user's Polyjuice address that corresponds to his individual Ethereum address though. **Polyjuice address is what SUDT-ERC20 proxy token smart contract will recognize for checking the balance of the bridged assets.**

This the code for calculating Polyjuice address from the Ethereum address:

```js
const { AddressTranslator } = require('nervos-godwoken-integration');

// ...

const addressTranslator = new AddressTranslator();
const polyjuiceAddress = addressTranslator.ethAddressToGodwokenShortAddress(ETHEREUM_ADDRESS);
console.log(`Corresponding Polyjuice address: ${polyjuiceAddress}\n`);
```

### 5. Display the User's Layer 2 Balance on Your Website

A requirement for being able to display Layer 2 balance of a bridged asset is to deploy a special smart contract which acts as a proxy.

In this step deploy SUDT-ERC20 Proxy smart contract for the transferred asset. You need to do it only once per asset. Later all users can use it (call `balanceOf` function). If you are bridging Ethereum on testnet it has a constant SUDT ID equal to **142**. You need to pass this parameter in a constructor. Regarding other constructor arguments you can be creative and choose anything that works for you.

[This is a tutorial how to deploy SUDT-ERC20 proxy smart contract.](./5.deploy.erc20.proxy.contract.md) 

> Note: Remember to use SUDT ID 142 if you integrated ETH currency support on testnet! :) Other assets such as USDT have different SUDT IDs.

### 6. Add Check Balance Smart Contract Call to Your Application

Use user's Polyjuice address from the 4th step to check the balance and display it to the user on your website.

At this point if the user has already completed his bridge transfer he can check the balance. If the balance is higher than zero it means you can just use this token as you would use any ERC20 token in your application.

[You can find tutorial and code how to check the bridged token balance here.](./5.deploy.erc20.proxy.contract.md#3-check-your-layer-2-sudt-balance)

> Note: If you would like to have more control over the bridge transfer and build your own frontend you can take advantage of [`BridgeRPCHandler`](https://github.com/Roger-RumbleFish/nervos-godwoken-integration/blob/master/src/bridge/force-bridge-handler.ts) exposed by `nervos-godwoken-integration`. This can eliminate a need for redirecting user outside of your application. It is considered advanced approach however.

## Task Submission

To complete the task, you will need to submit the following materials for review by the judges:

1. Link to the GitHub repository with your application that integrates Force Bridge support.
2. A screenshot or video of your ported application.
3. A SUDT-ERC20 Proxy smart contract address that you've deployed.
