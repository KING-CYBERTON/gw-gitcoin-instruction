# 4. Issue an SUDT Token on Layer 1 and Deposit it into Polyjuice on Layer 2

In this challenge, we create a token on Layer 1, then move it to the EVM compatible Layer 2. The token on Layer 1 will use the SUDT standard, which is the most basic form of asset on Nervos. When the token is moved to Layer 2, it is exchanged for an ERC20 token, which is the most popular token standard on blockchains that support the Ethereum Virtual Machine (EVM).

The reason that ERC20 tokens are used on Layer 2 is that this ensures full compatibility with EVM. Existing smart contracts that are designed for Ethereum, using languages like Solidity, will continue to work without modification. Because the EVM Layer 2 is based on optimistic rollups, any dapp built on it will immediately gain higher TPS with dramatically lower fees for all their users.

In the future, support for other blockchains, such as Cardano, Polkadot, and Stellar, can be added. This enables Nervos to support smart contracts from virtually any platform, and all of their respective token standards. All tokens based on any standard will be able to freely move between layers, and different environments, enabling asset transfer functionality that was previously difficult to impossible on many other competing platforms.

## Requirements

Before starting, you will need to setup your development environment. For information about system requirements and setup please [review this article](/src/challenge-setup-and-requirements/challenge-setup-and-requirements.md).

## Challenge Instructions

We will start by issuing an SUDT token on Layer 1. To do this, you will need the private key of a Layer 1 account that has been funded with Testnet CKBytes. You should already have this available from the previous challenges. You can then use the `sudt-cli` tool to create an SUDT token on the Layer 1 Testnet.

*Note: Usually you need to be very careful what you do with your private key, but here we operate on testnet (funds have no value) and we use open-source (all code is public) tools locally. You're safe.*

## [1. Setup Layer 1 account with funds](/src/component-tutorials/1.setup.keypering.with.funds.md)

After wallet is setup with funds, you can copy private key and use it with SUDT command-line interface to actually issue a token on Nervos Layer 1!

## [2. Use the Sudt-cli Tool to Issue an SUDT Token on Layer 1](/src/component-tutorials/9.issue.sudt.cli.md)

## 3. Configure Your Tool to Use a Testnet CKB Node

The Deposit Tool will require access to a CKB Node that is configured for the Testnet. You can either set one up locally using [these instructions](https://docs.nervos.org/docs/basics/guides/testnet), or you can use an existing public Testnet node. We provide the parameters to use the existing public node in the next step (`TESTNET_RPC_URL` and `TESTNET_INDEXER_URL`).

If you're running a local Testnet node, it will take 4-5 hours to synchronize, but you can optionally use a [bootstrap](https://ckb.tools/bootstrap) to speed up this process.

```sh
git clone https://github.com/Kuzirashi/godwoken-examples -b testnet-script
cd godwoken-examples
yarn && yarn run build-all
yarn run generate-testnet-configs
```

## 4. Deposit Layer 1 tokens (SUDT standard) to create a Layer 2 account

To deposit SUDT into Layer 2 execute following command in `godwoken-examples` directory, but first replace 5 variables with the values matching your wallet and node information.

```sh
node ./packages/tools/lib/account-cli.js deposit-sudt -m 400 -s <INSERT_TOKEN_SCRIPT_ARGS> -p <INSERT_PRIVATE_KEY> -l <INSERT_ETH_ADDRESS> -r <INSERT_TESTNET_RPC_URL> -d <INSERT_TESTNET_INDEXER_URL>
```

Variables:
1. `<INSERT_TOKEN_SCRIPT_ARGS>` - "SUDT Type Args" from SUDT CLI tool (you can see it after you issue token or when you call balance action). If you're unsure how to get it please revisit [Issue SUDT using command-line interface](/src/component-tutorials/9.issue.sudt.cli.md) tutorial.
2. `<INSERT_PRIVATE_KEY>` - private key to your account, the instructions how to get it are in [step 1 of this instruction](#1-setup-layer-1-account-with-funds)
3. `<INSERT_ETH_ADDRESS>` - the address of the account from MetaMask that you want to receive funds on Layer 2 to. Go to MetaMask, create account if you haven't already and copy the address.

<img src="../images/metamask-address.png" style="border: 1px solid #eeeeee; height: 300px" />

4. `<INSERT_TESTNET_RPC_URL>` - testnet node RPC URL, you can use existing one that we provide: `http://3.235.223.161:18114` or you can setup your own local node (it takes time to sync though)
5. `<INSERT_TESTNET_INDEXER_URL>` - testnet indexer URL, you can use existing one that we provide: `http://3.235.223.161:18116` or you can setup your own by using [ckb-indexer repository](https://github.com/nervosnetwork/ckb-indexer/)

---

Example final command:

``` sh
node ./packages/tools/lib/account-cli.js deposit-sudt -m 100 -s 0x6f33df7e3fffb47794f9ca37643118ba79207ac92596a0555e9038828e547357 -p 0x6cd5e7be2f6504aa5ae7c0c04178d8f47b7cfc63b71d95d9e6282f5b090431bf -l 0xD173313A51f8fc37BcF67569b463abd89d81844f
```

*Note: You have to wait for Lumos indexer to sync with testnet first. It might take a lot of time (up to few hours). Please be patient.*


<details>
  <summary>Example output (click here to expand)</summary>
  
  ```
waiting for sync ...
synced ...
using ckb address: ckt1qyqf22qfzaer95xm5d2m5km0f6k288x9warqnhsf4m
using eth address: 0xD173313A51f8fc37BcF67569b463abd89d81844f
rollupTypeHash: 0x0a30665c3047d65cb3651eda93182a0d2f2087317aaba3ab35f3a970089ea9b4
Layer 2 lock script hash: 0x54350d6e81f58c721e4e4c9528633f17fcdaf5f9e6c3c689289915706cdf398d
↑ Using this script hash to get user account id ↑
rollupTypeHash: 0x0a30665c3047d65cb3651eda93182a0d2f2087317aaba3ab35f3a970089ea9b4
Layer 1 sudt script hash: 0xfb0b3484c5982636441366b6973fd63889a58a7bda40550049e5893ced50f343
rollupTypeHash: 0x0a30665c3047d65cb3651eda93182a0d2f2087317aaba3ab35f3a970089ea9b4
layer 2 sudt script: {
  code_hash: '0xe8906fb79791f0a7b18a5515e6772b0e9777dea75c1ef5dd1c149c3e656820e6',
  hash_type: 'type',
  args: '0x0a30665c3047d65cb3651eda93182a0d2f2087317aaba3ab35f3a970089ea9b4fb0b3484c5982636441366b6973fd63889a58a7bda40550049e5893ced50f343'
}
Layer 2 sudt script hash: 0xecd214c0b2e60968d0cc2934e29ee34a16305fd1d4e29b45a62295c1ba438bef
↑ Using this script hash to get sudt account id ↑
txHash: 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8
--------- wait for tx deposit ----------
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is pending, waited for 0 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is pending, waited for 3 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is pending, waited for 6 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is pending, waited for 9 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is proposed, waited for 12 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is proposed, waited for 15 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is committed, waited for 18 seconds
tx 0x6746214d22b407aa982e42f274ecd417b6428fd640a303127fc4c60cc1a0a5b8 is committed!
waiting for layer 2 block producer collect the deposit cell ... 0 seconds
Your account id: 4
waiting for layer 2 block producer collect the deposit cell ... 5 seconds
waiting for layer 2 block producer collect the deposit cell ... 10 seconds
waiting for layer 2 block producer collect the deposit cell ... 15 seconds
waiting for layer 2 block producer collect the deposit cell ... 20 seconds
waiting for layer 2 block producer collect the deposit cell ... 25 seconds
waiting for layer 2 block producer collect the deposit cell ... 30 seconds
waiting for layer 2 block producer collect the deposit cell ... 35 seconds
waiting for layer 2 block producer collect the deposit cell ... 40 seconds
waiting for layer 2 block producer collect the deposit cell ... 45 seconds
Your sudt id: 21
ckb balance in godwoken is: 156000000000
sudt balance in godwoken is: 100
deposit success!
```
</details>

Congratulations! You've just deposited your Layer 1 tokens (SUDT) to your Ethereum-like Layer 2 account as ERC20!

---

**Attention: You can make syncing process faster by using checkpoint data. Terminate the script that's trying to run deposit command, then run following commands to do it:**
```
cd godwoken-examples
sudo apt-get install p7zip-full
chmod +x get-testnet-checkpoint-data.sh
./get-testnet-checkpoint-data.sh
```

**Now, run the deposit command again. The progress should be now substantially higher (higher than 90%). Wait for the remaining part to sync.**

**Potential errors and solutions**

If you get an error: "Not enough capacity in from infos!" then it means your account on Layer 1 (that you passed access to via private key) doesn't have enough funds to perform an operation.

If you get an error: "Not enough amount in from infos!" then it means you either didn't issue tokens on Layer 1 before running this command, or you've issued less than you want to deposit to Layer 2 now.